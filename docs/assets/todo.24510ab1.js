import{b as v,a as c,c as m,j as b}from"./jsx-runtime.ff779198.js";const I=(t,e)=>e.some(n=>t instanceof n);let S,T;function O(){return S||(S=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function V(){return T||(T=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const p=new WeakMap,y=new WeakMap,w=new WeakMap;function k(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",a),t.removeEventListener("error",o)},a=()=>{n(f(t.result)),s()},o=()=>{r(t.error),s()};t.addEventListener("success",a),t.addEventListener("error",o)});return w.set(e,t),e}function F(t){if(p.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",o),t.removeEventListener("abort",o)},a=()=>{n(),s()},o=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",a),t.addEventListener("error",o),t.addEventListener("abort",o)});p.set(t,e)}let x={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return p.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function P(t){x=t(x)}function R(t){return V().includes(t)?function(...e){return t.apply(g(this),e),f(this.request)}:function(...e){return f(t.apply(g(this),e))}}function W(t){return typeof t=="function"?R(t):(t instanceof IDBTransaction&&F(t),I(t,O())?new Proxy(t,x):t)}function f(t){if(t instanceof IDBRequest)return k(t);if(y.has(t))return y.get(t);const e=W(t);return e!==t&&(y.set(t,e),w.set(e,t)),e}const g=t=>w.get(t);function K(t,e,{blocked:n,upgrade:r,blocking:s,terminated:a}={}){const o=indexedDB.open(t,e),d=f(o);return r&&o.addEventListener("upgradeneeded",i=>{r(f(o.result),i.oldVersion,i.newVersion,f(o.transaction),i)}),n&&o.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),d.then(i=>{a&&i.addEventListener("close",()=>a()),s&&i.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),d}const N=["get","getKey","getAll","getAllKeys","count"],U=["put","add","delete","clear"],D=new Map;function E(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(D.get(e))return D.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=U.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||N.includes(n)))return;const a=async function(o,...d){const i=this.transaction(o,s?"readwrite":"readonly");let u=i.store;return r&&(u=u.index(d.shift())),(await Promise.all([u[n](...d),s&&i.done]))[0]};return D.set(e,a),a}P(t=>({...t,get:(e,n,r)=>E(e,n)||t.get(e,n,r),has:(e,n)=>!!E(e,n)||t.has(e,n)}));const _=["continue","continuePrimaryKey","advance"],C={},B=new WeakMap,A=new WeakMap,$={get(t,e){if(!_.includes(e))return t[e];let n=C[e];return n||(n=C[e]=function(...r){B.set(this,A.get(this)[e](...r))}),n}};async function*z(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,$);for(A.set(n,e),w.set(n,g(e));e;)yield n,e=await(B.get(n)||e.continue()),B.delete(n)}function M(t,e){return e===Symbol.asyncIterator&&I(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&I(t,[IDBIndex,IDBObjectStore])}P(t=>({...t,get(e,n,r){return M(e,n)?z:t.get(e,n,r)},has(e,n){return M(e,n)||t.has(e,n)}}));async function G(t){t.createObjectStore("todos",{keyPath:"id",autoIncrement:!0})}async function H(){return K("to-do-app-db",1,{upgrade:G})}const h=H(),l={async add(t){const n=(await h).transaction("todos","readwrite");n.objectStore("todos").add(t),await n.done},async getAll(){return(await h).transaction("todos","readonly").objectStore("todos").getAll()},async remove(t){const n=(await h).transaction("todos","readwrite");n.objectStore("todos").delete(t),await n.done},async update(t){const n=(await h).transaction("todos","readwrite");n.objectStore("todos").put(t),await n.done},async clear(){const e=(await h).transaction("todos","readwrite");e.objectStore("todos").clear(),await e.done}};function J(){const[t,e]=m.exports.useState([]);m.exports.useEffect(()=>{l.getAll().then(e)},[]);function n(o){o.preventDefault();const d={id:Date.now(),text:new FormData(o.target).get("todo-text")};l.add(d).then(l.getAll).then(e)}const r=o=>()=>{l.remove(o.id).then(l.getAll).then(e)},s=o=>()=>{l.update(o).then(l.getAll).then(e)};return b("main",{children:[c("h1",{children:"To Do App"}),c(j,{onSubmit:n,inputname:"todo-text",buttonText:"Add"}),c("button",{onClick:()=>l.clear().then(l.getAll).then(e),children:"Clear All To Do Items"}),c("h2",{children:"To Do List"}),c("ul",{children:t.map(o=>c(Q,{todo:o,todoremover:r,todoUpdater:s},o.id))})]})}function Q({todo:t,todoremover:e,todoUpdater:n}){const{id:r,text:s}=t,[a,o]=m.exports.useState(!1),d="updater-todo-text";function i(u){u.preventDefault();const L=new FormData(u.target).get(d);n({id:r,text:L})(),o(!1)}return a?b("li",{children:[c(j,{onSubmit:i,inputname:d,buttonText:"Save",placeholder:s,defaultValue:s}),c("button",{onClick:()=>o(!1),children:"Cancel"})]},r):b("li",{children:[c("span",{children:s}),c("button",{onClick:e(t),children:"Delete"}),c("button",{onClick:()=>o(!0),children:"Edit"})]},r)}function j({onSubmit:t,inputname:e,buttonText:n,placeholder:r,defaultValue:s}){return b("form",{onSubmit:t,children:[c("input",{type:"text",name:e,placeholder:r,defaultValue:s,required:!0,autoComplete:"off",pattern:".*\\S+.*"}),c("button",{type:"submit",children:n})]})}v.createRoot(document.getElementById("root")).render(c(m.exports.StrictMode,{children:c(J,{})}));
